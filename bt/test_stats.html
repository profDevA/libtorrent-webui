<!DOCTYPE html>
<meta charset="utf-8" />
<title>libtorrent websocket test</title>
<script language="javascript" type="text/javascript" src="libtorrent-webui.js"></script>
<script language="javascript" type="text/javascript" src="lt-g.js"></script>
<script language="javascript" type="text/javascript">

var conn = null;

var first_time = new Date().getTime();

on_stats = function(updates)
{
	if (typeof(updates) === 'string')
	{
		console.log("ERROR: " + updates);
		return;
	}

	for (i in updates)
	{
		var row = document.getElementById('' + i);
		if (row == null) continue;
		row.cells[2].textContent = updates[i];
	}
};

window.onload = function() {
	var url = 'ws://' + window.location.host + '/bt/control';
	conn = new libtorrent_connection(url, function(state)
	{
		if (state != "OK") {
			console.log(state);
			return;
		}

		conn.list_stats(function(stats)
		{
			var table = document.getElementById('stats');
			for (s in stats)
			{
				var row = table.insertRow(-1);
				row.id = '' + s;
				row.insertCell(0).textContent = stats[s].name;
				row.insertCell(1).textContent = stats[s].type == 0 ? 'counter' : 'gauge';
				row.insertCell(2).textContent = '';
			}

			window.setInterval(function()
			{
				conn.get_stats(on_stats);
			}, 500);
		});
	});
};
</script>
<style>.updated { background-color: #faa; }</style>
<table id="stats" border="1" style="border-collapse: collapse; border-color: black;">
<tr><th>Name</th><th>Type</th><th>Value</th></tr>
</table>
<canvas id="graph" width="800" height="500"/>
</html>

